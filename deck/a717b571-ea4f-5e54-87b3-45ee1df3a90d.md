---
tags:
- card_type/scenario
- debugging/compiled-code
- development/jinja-macros
- testing/test-config
citations:
- cleaned_docs/grants/rank_10.md
guid: a1e4132062
source: llm
uuid: a717b571-ea4f-5e54-87b3-45ee1df3a90d
---

<front>

You want to write a record to an audit table immediately after a dbt run only for models that returned an error. How would you implement this?

</front>

---

<back>

Define a macro called in the `on-run-end` hook that iterates through the `results` context variable. Filter for results where the status indicates failure.

```jinja
{% for res in results %}
  {% if res.status == 'error' %}
     -- Insert logic here using res.message
  {% endif %}
{% endfor %}
```

</back>
