---
tags:
- card_type/scenario
- debugging/compiled-code
- development/materializations
- state/selectors
citations:
- cleaned_docs/sql-performance/rank_7.md
guid: 6e6570196b
source: llm
uuid: 837e1d68-9eae-5438-b60f-e04b3e24de80
---

<front>

You are calculating a cumulative `lifetime_value` for users in an incremental model. How do you ensure the calculation includes previous spend during an incremental run?

</front>

---

<back>

Use the `is_incremental()` macro to conditionally join the new data with the existing table (`{{ this }}`) to retrieve prior totals, or expand the data selection logic to include relevant history.

```sql
{% if is_incremental() %}
  select ... from stg_orders o
  left join {{ this }} existing on o.user_id = existing.user_id
{% endif %}
```

</back>
