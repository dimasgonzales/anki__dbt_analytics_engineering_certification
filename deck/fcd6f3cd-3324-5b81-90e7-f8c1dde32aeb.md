---
tags:
  - compiled-code
  - snapshots
  - jinja-macros
citations:
- cleaned_docs/jinja-macros/rank_2.md
guid: 687de8ea76
source: llm
uuid: fcd6f3cd-3324-5b81-90e7-f8c1dde32aeb
---

<front>

You are writing a dbt model to pivot payment methods into columns using a Jinja loop. The compiled SQL fails because there is a comma after the last column definition. How do you fix this?

</front>

---

<back>

Add a condition to check `loop.last` inside the loop logic.

Example:
```sql
{% for method in methods %}
  ... as {{ method }}_amount
  {%- if not loop.last %},{% endif -%}
{% endfor %}
```

</back>
