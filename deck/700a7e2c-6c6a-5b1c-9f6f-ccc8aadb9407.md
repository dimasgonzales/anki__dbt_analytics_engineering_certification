---
tags:
- card_type/scenario
- debugging/yaml-compilation
- development/jinja-macros
- governance/model-access
citations:
- cleaned_docs/snapshots/rank_10.md
guid: 7606f49c9c
source: llm
uuid: 700a7e2c-6c6a-5b1c-9f6f-ccc8aadb9407
---

<front>

A macro iterating through `graph.nodes` throws an error stating the graph variable is undefined or incomplete during `dbt compile`. What is the likely cause and fix?

</front>

---

<back>

The macro is trying to access the graph during the parsing phase. To fix this, wrap the graph access logic in an execute block:

```sql
{% if execute %}
  {% set nodes = graph.nodes.values() %}
  ... logic ...
{% endif %}
```

</back>
